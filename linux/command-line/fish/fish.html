<!-- fish -->
<p></p>
<h1 id="setup">Setup <!-- {{{1 --></h1>
<h3 id="set-fish-as-the-default-system-shell-in-fish">set fish as the default system shell in fish</h3>
<pre><code>chsh -s (which fish)</code></pre>
<h3 id="configuration-entry-point">configuration entry point</h3>
<pre><code>vim ~/.config/fish/config.fish</code></pre>
<h3 id="sourcing">sourcing</h3>
<pre><code>source ~/git/dot-files/fish/3fishrc-root-macbook</code></pre>
<h3 id="disable-svn-for-good">disable svn for good</h3>
<pre><code>function svn
end</code></pre>
<p></p>
<h1 id="fish-specific-keyboard-shortcuts">Fish-specific keyboard shortcuts <!-- {{{1 --></h1>
<p><code>&lt;c-f&gt;</code> same as right arrow key, to accept auto-suggestions or move right</p>
<p><code>&lt;c-b&gt;</code> same as left arrow key</p>
<p><code>&lt;c-p&gt;</code> same as upper arrow key</p>
<p><code>&lt;c-n&gt;</code> same as lower arrow key</p>
<p><code>&lt;c-l&gt;</code> or <code>&lt;command-r&gt; on mac</code> clean screen better than <strong>clear</strong></p>
<p><code>&lt;c-i&gt;</code> same as <code>&lt;tab&gt;</code></p>
<p><code>bind</code> see all fish command line shortcuts</p>
<p></p>
<h1 id="if-statement">If statement <!-- {{{1 --></h1>
<pre><code>set -xU I_AM_TRUE 1
if test -n &quot;$I_AM_TRUE&quot;
  echo &quot;now you see me&quot;
end
if test -n &quot;$I_AM_FALSE&quot;
  echo &quot;now you don&#39;t&quot;
end</code></pre>
<p></p>
<h1 id="switch-statement">Switch statement <!-- {{{1 --></h1>
<pre><code>function showmethedir
  switch $PWD
    case $GITHUB_DIR/learn/learn-linux/command-line/fish
      echo &#39;this is fish/ directory haha~&#39;
    case $GITHUB_DIR/learn/learn-linux/command-line
      echo &#39;this is command-line/ directory oh yeah~&#39;
    case &#39;*&#39;
      echo &#39;I do not recognize this directory&#39;
  end
end
cd $GITHUB_DIR/learn/learn-linux/
showmethedir #I do not recognize this directory
cd $GITHUB_DIR/learn/learn-linux/command-line
showmethedir #this is command-line/ directory oh yeah~
cd $GITHUB_DIR/learn/learn-linux/command-line/fish
showmethedir #this is fish/ directory haha~</code></pre>
<p></p>
<h1 id="functions">Functions <!-- {{{1 --></h1>
<h2 id="argv">argv <!-- {{{2 --></h2>
<p><code>$argv[1]</code> is the <strong>first</strong> element, not the second.</p>
<pre><code>function func
  echo $argv[1]+$argv[3]
end
func 1 2 3 # 1+3</code></pre>
<p><code>$argv</code> can also be used as a whole.</p>
<pre><code>function vimvanilla
  vim -u NONE -N $argv
end
vimvanilla $GITHUB_DIR/learn/learn-linux/command-line/fish/fish.md +55 #this line</code></pre>
<h2 id="only-define-undefined-functions">Only define undefined functions <!-- {{{2 --></h2>
<pre><code># new definition wins
function ilikenewdefinition
  echo &#39;hello world&#39;
end
function ilikenewdefinition
  echo &#39;another definition&#39;
end
ilikenewdefinition
# old definition wins
type onlydefinemeonce &gt; /dev/null 2&gt;&amp;1; or function onlydefinemeonce
  echo &#39;hello world&#39;
end
type onlydefinemeonce &gt; /dev/null 2&gt;&amp;1; or function onlydefinemeonce
  echo &#39;you no see me&#39;
end
onlydefinemeonce</code></pre>
<p></p>
<h1 id="and-or">and, or <!-- {{{1 --></h1>
<p><code>and</code> only runs when the previous command returns true.</p>
<p><code>or</code> only runs when the previous command returns false.</p>
<h2 id="a-safer-way-to-cat">A safer way to cat <!-- {{{2 --></h2>
<pre><code># nasty error message if file not exist
cat resources/file_that_may_not.exist
# no error message
test -s resources/file_that_may_not.exist; and cat resources/file_that_may_not.exist</code></pre>
<h2 id="a-safer-mv">A safer mv <!-- {{{2 --></h2>
<pre><code>function asafermvsetup
  echo &#39;important content&#39; &gt; resources/asafermv
  echo &#39;new content&#39; &gt; resources/asafermv2
end
asafermvsetup
#
# the previous content in asafermv is then lost
mv resources/asafermv2 resources/asafermv
cat resources/asafermv # new content
#
function safermv
  test -s $argv[2]; or mv $argv[1] $argv[2]
end
# the previous content in asafermv is preserved
asafermvsetup
safermv resources/asafermv2 resources/asafermv
cat resources/asafermv # important content</code></pre>
<h5 id="but-of-course-the-best-way-is-always-mv--i-which-prompts-on-conflict">But of course, the best way is always mv -i which prompts on conflict</h5>
<pre><code>mv -i resources/asafermv2 resources/asafermv</code></pre>
<p></p>
<h1 id="prompt">prompt <!-- {{{1 --></h1>
<h2 id="verbose-prompt">Verbose prompt <!-- {{{2 --></h2>
<p>a prompt that looks like: <code>tangke@Kirks-MacBook-Pro ~/g/active-notes:master</code>, or <img src="./resources/prompt.png" /></p>
<pre><code># red for dirty git branches
set fish_git_dirty_color red
# green for clean git branches
set fish_git_not_dirty_color green
# process git status
type parse_git_branch &gt; /dev/null 2&gt;&amp;1; or function parse_git_branch
  # define branch name
  set -l branch (git branch 2&gt; /dev/null | grep -e &#39;\* &#39; | sed &#39;s/^..\(.*\)/\1/&#39;)

  # define git_diff (we only care about whether it&#39;s empty)
  set -l git_diff (git diff)

  # apply different colors based on whether the git branch is dirty
  if test -n &quot;$git_diff&quot;
    echo (set_color $fish_git_dirty_color)$branch(set_color normal)
  else
    echo (set_color $fish_git_not_dirty_color)$branch(set_color normal)
  end
end
function fish_prompt
  set -l git_dir (git rev-parse --git-dir 2&gt; /dev/null)
  if test -n &quot;$git_dir&quot;
    printf &#39;%s@%s %s%s%s:%s&gt; &#39; (whoami) (hostname|cut -d . -f 1) \
      (set_color $fish_color_cwd) (prompt_pwd) (set_color normal) (parse_git_branch)
  else
    printf &#39;%s@%s %s%s%s&gt; &#39; (whoami) (hostname|cut -d . -f 1) \
      (set_color $fish_color_cwd) (prompt_pwd) (set_color normal)
  end
end</code></pre>
<h2 id="simplified-prompt">Simplified prompt <!-- {{{2 --></h2>
<p>a slightly simpler prompt that looks like: <code>~/g/active-notes:master</code>, or <img src="./resources/simpler-prompt.png" /></p>
<pre><code># red for dirty git branches
set fish_git_dirty_color red
# green for clean git branches
set fish_git_not_dirty_color green
# process git status
type parse_git_branch &gt; /dev/null 2&gt;&amp;1; or function parse_git_branch
  # define branch name
  set -l branch (git branch 2&gt; /dev/null | grep -e &#39;\* &#39; | sed &#39;s/^..\(.*\)/\1/&#39;)

  # define git_diff (we only care about whether it&#39;s empty)
  set -l git_diff (git diff)

  # apply different colors based on whether the git branch is dirty
  if test -n &quot;$git_diff&quot;
    echo (set_color $fish_git_dirty_color)$branch(set_color normal)
  else
    echo (set_color $fish_git_not_dirty_color)$branch(set_color normal)
  end
end
function fish_prompt
  set -l git_dir (git rev-parse --git-dir 2&gt; /dev/null)
  if test -n &quot;$git_dir&quot;
    printf &#39;%s%s%s:%s&gt; &#39; (set_color $fish_color_cwd) (prompt_pwd) \
      (set_color normal) (parse_git_branch)
  else
    printf &#39;%s%s%s&gt; &#39; (set_color $fish_color_cwd) (prompt_pwd) (set_color normal)
  end
end</code></pre>
<p></p>
<h1 id="miscellaneous">Miscellaneous <!-- {{{1 --></h1>
<h2 id="single-quotes-and-double-quotes">Single quotes and double quotes <!-- {{{2 --></h2>
<p>use <code>'</code> or <code>&quot;</code> to escape spaces for file names and grep key words. In bash, <code>'</code> and <code>&quot;</code> are slightly different, as <code>&quot;</code> doesn't prevent special characters from expanding, but in fish they are identical (which is really nice).</p>
